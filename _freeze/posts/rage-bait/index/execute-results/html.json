{
  "hash": "98cb3ddb97dd8f1ea53171ce471c26f8",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: fable, we're beefing\n---\n\nFable doesn't allow export to csv, so we're DIYing it.\n\n::: {#42681844 .cell execution_count=1}\n``` {.python .cell-code}\nimport requests\nraw_request = requests.get(\"https://api.fable.co/api/users/529c21d5-fa03-461f-9711-eb061628003f/reviews/?limit=100\").json()\ndata = raw_request.get(\"results\")\n```\n:::\n\n\n::: {#263dff40 .cell execution_count=2}\n``` {.python .cell-code}\nimport polars as pl\n\ncols = ['book', 'rating', 'review', 'created_at']\ndf = pl.DataFrame(data)\ndf = df[cols].unnest('book')\n```\n:::\n\n\n::: {#5bb75732 .cell execution_count=3}\n``` {.python .cell-code}\nnew_cols = ['title', 'authors', 'page_count', 'published_date', 'price_usd', 'subjects', 'background_color', 'review_average', 'review_count', 'genres', 'rating', 'review', 'created_at']\nmax_authors = df.select(pl.col(\"authors\").list.len().max()).item()\nmax_genres = df.select(pl.col(\"genres\").list.len().max()).item()\n\nclean = df[new_cols].with_columns(\n        (\n          pl.col(\"authors\")\n          .list.eval(pl.element().struct.field(\"name\"))\n          .list.to_struct(fields=lambda i: f\"author_{i+1}\", upper_bound=max_authors)\n        ),\n        (\n          pl.col(\"genres\")\n          .list.eval(pl.element().struct.field(\"name\"))\n          .list.to_struct(fields=lambda i: f\"genre_{i+1}\", upper_bound=max_genres)\n        ),\n        (\n          pl.col(\"subjects\")\n          .map_elements(\n            lambda x: [item for sublist in x for item in sublist] if x is not None else [],\n            return_dtype=pl.List(pl.String)\n          )\n        ),\n        (pl.col(\"rating\").cast(pl.Float64)),\n        ((pl.col(\"rating\").cast(pl.Float64) - pl.col(\"review_average\")).alias(\"rating_difference\"))\n      )\\\n    .unnest(\"authors\")\\\n    .unnest(\"genres\")\n```\n:::\n\n\n::: {#1b259681 .cell execution_count=4}\n``` {.python .cell-code}\nfrom plotnine import ggplot, aes, geom_bar, geom_histogram, geom_point, coord_flip, theme_classic\n```\n:::\n\n\n::: {#f4507823 .cell execution_count=5}\n``` {.python .cell-code}\navg_diff = clean['rating_difference'].mean()\n```\n:::\n\n\n::: {#2cc45cd5 .cell execution_count=6}\n``` {.python .cell-code}\nggplot(clean) + geom_histogram(aes(x=\"rating_difference\"))\n\nggplot(clean) + geom_point(aes(x=\"rating\", y = \"review_average\", color = \"rating_difference\"))\n```\n\n::: {.cell-output .cell-output-display}\n![](index_files/figure-html/cell-7-output-1.png){width=672 height=480}\n:::\n:::\n\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [],
    "includes": {}
  }
}